<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <meta name="keywords" content="" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!--Meta Responsive tag-->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!--Bootstrap CSS-->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
    <!--Custom style.css-->
    <link rel="stylesheet" href="assets/css/quicksand.css" />
    <link rel="stylesheet" href="assets/css/style.css" />
    <!--Font Awesome-->
    <link rel="stylesheet" href="assets/css/fontawesome.css" />
    <!--Chartist CSS-->
    <link rel="stylesheet" href="assets/css/chartist.min.css" />
    <!--Bootstrap Calendar-->
    <link rel="stylesheet" href="assets/js/calendar/bootstrap_calendar.css" />
    <!--Form validator-->
    <link
      rel="stylesheet"
      href="assets/js/form-validator/theme-default.min.css"
    />
    <style>
      @media (min-width: 576px) {
        .main-content {
          display: flex;
          flex-wrap: nowrap;
        }

        .sidebar {
          max-width: 25%;
          flex: 0 0 25%;
        }

        .content {
          max-width: 75%;
          flex: 0 0 75%;
          overflow-x: auto;
        }

        #document_editor {
          max-width: 100%;
          overflow-x: auto;
        }
      }
    </style>
    <!--Ckeditor-->
    <script src="assets/js/ckeditor5/build-document/ckeditor.js"></script>
    <!-- Ajout de html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <title>ExamXpress</title>
  </head>
  <body>
    <!--Page loader-->
    <div class="loader-wrapper">
      <div class="loader-circle">
        <div class="loader-wave">ExamXpress</div>
      </div>
    </div>
    <!--Page loader-->

    <!--Page Wrapper-->

    <div class="container-fluid">
      <!--Header-->
      <div class="row header shadow-sm">
        <!--Logo-->
        <div class="col-sm-3 pl-0 text-center header-logo">
          <div class="bg-theme mr-3 pt-3 pb-2 mb-0">
            <h3 class="logo">
              <a href="#" class="text-secondary logo"
                ><i class="fa fa-rocket"></i> ExamX<span class="small"
                  >pert</span
                ></a
              >
            </h3>
          </div>
        </div>
        <!--Logo-->
        <!--Header Menu-->
        <div class="col-sm-9 header-menu pt-2 pb-0">
          <div class="row">
            <!--Menu Icons-->
            <div class="col-sm-4 col-8 pl-0">
              <!--Toggle sidebar-->
              <span class="menu-icon" onclick="toggle_sidebar()">
                <span id="sidebar-toggle-btn"></span>
              </span>
            </div>

            <!--Search box and avatar-->
            <div
              class="col-sm-8 col-4 text-right flex-header-menu justify-content-end"
            >
              <h6 class="mb-2">
                Dashboard <i class="fa fa-angle-right"></i> NOMPAGECREER
              </h6>
            </div>
          </div>
        </div>
      </div>
      <!--Header-->

      <!--Main Content-->

      <div class="row main-content">
        <!--Sidebar left-->
        <div class="col-sm-3 col-xs-6 sidebar pl-0">
          <div class="inner-sidebar mr-3">
            <!--Image Avatar-->
            <br /><br />
            <div class="avatar text-center">
              <img
                src="assets/img/client-img4.png"
                alt=""
                class="rounded-circle"
              />
              <p><strong> NOM UTILISATEUR </strong></p>
              <span class="text-primary small"
                ><strong>PROFFESSION UTILISATEUR</strong></span
              >
            </div>
            <!--Image Avatar-->

            <!--Sidebar Navigation Menu-->
            <div class="sidebar-menu-container">
              <ul class="sidebar-menu mt-4 mb-4">
                <li class="parent">
                  <a href="#">
                    <i class="fa fa-dashboard mr-3"> </i>
                    <span class="none">Dashboard </span>
                  </a>
                </li>
                <li class="parent">
                  <a
                    href="#"
                    onclick="toggle_menu('dashboard'); return false"
                    class=""
                    ><i class="fa fa-book mr-3"> </i>
                    <span class="none"
                      >Evaluation
                      <i class="fa fa-angle-down pull-right align-bottom"></i
                    ></span>
                  </a>
                  <ul class="children" id="dashboard">
                    <li class="child">
                      <a href="#" class="ml-4"
                        ><i class="fa fa-angle-right mr-2"></i> Creer
                        Evaluation</a
                      >
                    </li>
                    <li class="child">
                      <a href="#" class="ml-4"
                        ><i class="fa fa-angle-right mr-2"></i> Deposer
                        Evaluation</a
                      >
                    </li>
                  </ul>
                </li>
                <li class="parent">
                  <a href="#" class=""
                    ><i class="fa fa-pencil mr-3"></i>
                    <span class="none">Gestion Notes </span>
                  </a>
                </li>
                <li class="parent">
                  <a href="#" class=""
                    ><i class="fa fa-rocket mr-3"></i>
                    <span class="none">ExamXpert</span>
                  </a>
                </li>
                <br /><br />

                <li class="parent">
                  <a href="#" class=""
                    ><i class="fa fa-sign-out mr-3"></i>
                    <span class="none">Log Out </span>
                  </a>
                </li>
              </ul>
            </div>
            <!--Sidebar Navigation Menu-->
          </div>
        </div>
        <!--Sidebar left-->

        <!--Content right-->
        <div class="col-sm-9 col-xs-12 content pt-3 pl-0">
          <h5 class="mb-3"><strong>Creer l'examen</strong></h5>

          <div class="mt-1 mb-3 button-container">
            <h6 class="mb-2">Document Ckeditor</h6>

            <div class="" id="toolbar-container"></div>
            <div class="p-5 border" style="background: #eee">
              <div
                id="document_editor"
                class="editor bg-white shadow-sm mx-5 p-5"
              >
                <h3 style="text-align: center">Examen / Devoir</h3>
                <h4 style="text-align: center">
                  Créer et déposer des sujets d'examen (format PDF ou texte)
                </h4>

                <p>Cher Proffeseur,</p>

                <p>
                  Lorem Ipsum is simply dummy text of the printing and
                  typesetting industry. Lorem Ipsum has been the industry's
                  standard dummy text ever since the 1500s, when an unknown
                  printer took a galley of type and scrambled it to make a type
                  specimen book. It has survived not only five centuries, but
                  also the leap into electronic typesetting, remaining
                  essentially unchanged. It was popularised in the 1960s with
                  the release of Letraset sheets containing Lorem Ipsum
                  passages, and more recently with desktop publishing software
                  like Aldus PageMaker including versions of Lorem Ipsum.
                </p>
                <br />

                <p>
                  Lorem Ipsum is simply dummy text of the printing and
                  typesetting industry. Lorem Ipsum has been the industry's
                  standard dummy text ever since the 1500s, when an unknown
                  printer took a galley of type and scrambled it to make a type
                  specimen book. It has survived not only five centuries, but
                  also the leap into electronic typesetting, remaining
                  essentially unchanged. It was popularised in the 1960s with
                  the release of Letraset sheets containing Lorem Ipsum
                  passages, and more recently with desktop publishing software
                  like Aldus PageMaker including versions of Lorem Ipsum.
                </p>
                <br />

                <p>
                  Lorem Ipsum is simply dummy text of the printing and
                  typesetting industry. Lorem Ipsum has been the industry's
                  standard dummy text ever since the 1500s, when an unknown
                  printer took a galley of type and scrambled it to make a type
                  specimen book. It has survived not only five centuries, but
                  also the leap into electronic typesetting, remaining
                  essentially unchanged. It was popularised in the 1960s with
                  the release of Letraset sheets containing Lorem Ipsum
                  passages, and more recently with desktop publishing software
                  like Aldus PageMaker including versions of Lorem Ipsum.
                </p>
              </div>

              <!-- Bouton de téléchargement -->
              <button
                class="btn btn-primary mt-3"
                onclick="downloadDocument('txt')"
              >
                Télécharger en TXT
              </button>
              <button
                class="btn btn-danger mt-3"
                onclick="downloadDocument('pdf')"
              >
                Télécharger en PDF
              </button>
            </div>
            <!--/Document CKeditor-->
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
            <script>
              let editorInstance; // Stocker l'éditeur globalement

              // Initialisation de CKEditor
              DecoupledEditor.create(document.querySelector("#document_editor"))
                .then((editor) => {
                  editorInstance = editor; // Sauvegarde de l'éditeur
                  const toolbarContainer =
                    document.querySelector("#toolbar-container");
                  toolbarContainer.appendChild(editor.ui.view.toolbar.element);
                })
                .catch((error) => {
                  console.error("Erreur de chargement de CKEditor :", error);
                });

              function downloadDocument(format) {
                if (!editorInstance) {
                  console.error("L'éditeur n'est pas encore chargé.");
                  return;
                }

                const htmlContent = editorInstance.getData(); // Récupérer le contenu HTML
                const tempElement = document.createElement("div");
                tempElement.innerHTML = htmlContent;
                const textContent =
                  tempElement.innerText || tempElement.textContent; // Extraire le texte brut

                if (format === "txt") {
                  // Téléchargement en TXT
                  const blob = new Blob([textContent], { type: "text/plain" });
                  const link = document.createElement("a");
                  link.href = URL.createObjectURL(blob);
                  link.download = "document.txt";
                  link.click();
                  URL.revokeObjectURL(link.href);
                } else if (format === "pdf") {
                  // Télécharger en PDF avec mise en forme
                  const { jsPDF } = window.jspdf;
                  const doc = new jsPDF("p", "mm", "a4");

                  // Utilisation de html2canvas pour capturer le rendu de l'éditeur
                  html2canvas(document.querySelector("#document_editor"), {
                    scale: 2,
                  }).then((canvas) => {
                    const imgData = canvas.toDataURL("image/png");
                    const imgWidth = 190; // Largeur en mm
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;

                    doc.addImage(imgData, "PNG", 10, 10, imgWidth, imgHeight);
                    doc.save("document.pdf");
                  });
                }
              }
            </script>
          </div>
        </div>
      </div>

      <!--Main Content-->
    </div>

    <!--Page Wrapper-->

    <!-- Page JavaScript Files-->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/jquery-1.12.4.min.js"></script>
    <!--Popper JS-->
    <script src="assets/js/popper.min.js"></script>
    <!--Bootstrap-->
    <script src="assets/js/bootstrap.min.js"></script>
    <!--Sweet alert JS-->
    <script src="assets/js/sweetalert.js"></script>
    <!--Progressbar JS-->
    <script src="assets/js/progressbar.min.js"></script>
    <!--Charts-->
    <!--Canvas JS-->
    <script src="assets/js/charts/canvas.min.js"></script>
    <!--Bootstrap Calendar JS-->
    <script src="assets/js/calendar/bootstrap_calendar.js"></script>
    <script src="assets/js/calendar/demo.js"></script>
    <!--Bootstrap Calendar-->

    <!--Custom Js Script-->
    <script src="assets/js/custom.js"></script>
    <!--Custom Js Script-->
    <script src="assets/js/dashboard-profile.js"></script>
    <script src="assets/js/sidebar-navigation.js"></script>
  </body>
</html>
